# USBIP

## 1. 工程一览

按依赖排序
  - libdrv
    - usbip_stub
    - usbip_vhci
    - usbip_vhci_ude
  - usbip_common
    - attacher
    - usbip
    - usbipd



| 工程名 | 目录 | 工程说明 |
| -- | -- | -- |
| libdrv | /driver/lib/ | 基础工程。定义usbip协议，编写usbip结构体与系统usbd结构体之间的转换工具。 |
| usbip_stub | /driver/stub/ | 驱动程序工程。定义如何处理IRP消息。 |
| usbip_vhci | /driver/vhci/ |  |
| usbip_vhci_ude | /driver/vhci_ude/ |  |
| usbip_common | /userspace/lib/ |  |
| attacher | /userspace/src/attacher |  |
| usbip | /userspace/src/usbip/ |  |
| usbipd | /userspace/src/usbipd/ |  |


## 2. 文件一览(按工程)

### 2.1 libdrv

| 文件名 | 文件说明 |
| -- | -- |
| dbgcode.c | debug 相关代码 |
| dbgcommon.c | debug 公共工具定义 |
| devconf.c | usb 接口描述符相关方法 |
| pdu.c | 工具类，对usbip_header结构体的部分数据进行大小端反转 |
| strutil.c | 字符串工具类。如获取字符串长度，格式化字符串。 |
| usb_util.c | usb工具类。获取usb设备的类型。 |
| usbd_helper.c | usbd工具类。进行usbd结构体和usbip结构体之间的转换。 |
| usbip_proto.h | usbip的通讯结构体定义。 |

### 2.2 usbip_stub

| 文件名 | 文件说明 |
| -- | -- |
| stub_driver.c | 驱动加载主入口 DriverEntry |
| stub_dispatch.c | IRP 处理函数。这里是主入口，函数内部再进行按功能分发。 |
| stub_pnp.c | IRP_MJ_PNP 消息处理函数。由 stub_dispatch.c 进行调用。 |
| stub_power.c | IRP_MJ_POWER 消息处理函数。由 stub_dispatch.c 进行调用。 |
| stub_ioctl.c | IRP_MJ_DEVICE_CONTROL 消息处理函数。由 stub_dispatch.c 进行调用。 |
| stub_read.c | IRP_MJ_READ 消息处理函数。由 stub_dispatch.c 进行调用。 |
| stub_write.c | IRP_MJ_WRITE 消息处理函数。由 stub_dispatch.c 进行调用。 |
| stub_irp.c | 其他 IRP 消息默认处理函数。由 stub_dispatch.c 进行调用。 |
| stub_cspkt.c | debug 通讯包。 |
| stub_dbg.c | debug 驱动和设备。 |
| stub_dev.c | 定义如何新增设备，由stub_driver.c引入。 |
| stub_devconf.c | 定义设备配置信息结构体。 |
| stub_reg.c | 获取设备属性辅助方法。 |
| stub_res.c | 设备资源(resource)相关处理方法。资源即是对IRP与报文的封装。 |
| stub_usbd.c | 部分消息需要通过网络发送到 usbd 的，在这里进行定义和处理。 |



### usbip

| 文件名 | 文件说明 |
| -- | -- |
| usbip.c | 主入口 |
| usbip_list.c | list 命令主入口 |
| usbip_list_local.c | list -l 执行入口 |


### lib

| 文件名 | 文件说明 |
| -- | -- |
| names.c | 解析 usb.ids 文件，把里面的数据读取到几个链表中。 |
